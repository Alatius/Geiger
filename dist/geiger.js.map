{"version":3,"sources":["geiger.js"],"names":[],"mappings":"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","file":"geiger.js","sourcesContent":["'use strict';\n\nimport { EventEmitter } from 'events';\n\nexport class Action extends EventEmitter { }\n\nexport class Store extends EventEmitter {\n\n    constructor(...args) {\n        super(...args);\n        this.dispatching = [];\n        this.waiting = [];\n    }\n\n    changed() { this.emit('change'); }\n\n    watch(cbk) {\n        this.on('change', cbk);\n        return () => this.removeListener('change', cbk);\n    }\n\n    isDispatching() { return this.dispatching.length > 0; }\n\n    isWaiting() { return this.waiting.length > 0; }\n\n    listen(actions, event, cbk) {\n\n        if(typeof actions !== 'object' || typeof actions.on !== 'function') { throw new Error('Store ' + this.constructor.name + '.listen() method expects an EventEmitter-compatible object as a first parameter.'); }\n\n        actions.on(event, (...args) => {\n\n            // dispatching begins\n            this.dispatching.push(event);\n\n            const res = cbk(...args);\n            const ispromise = (typeof res === 'object' && typeof res.then === 'function');\n\n            if(this.isWaiting() && !ispromise) { throw new Error('Store ' + this.constructor.name + ' waiting; action has to return the waiting promise (the promise returned by waitFor).'); }\n\n            const dispatchingEnd = () => {\n                this.dispatching.pop();\n                this.emit('dispatching:end', event);\n                // dispatching ends\n            };\n\n            if(ispromise) {\n                res.then(dispatchingEnd);\n            } else {\n                dispatchingEnd();\n            }\n\n            return res;\n        });\n    }\n\n    wait(...args) {\n        console.log('Geiger: wait() is deprecated in favour of waitFor(). Please, update your codebase.');\n        return this.waitFor(...args);\n    }\n\n    waitFor(stores) {\n\n        this.waiting.push(true);\n\n        const promises = [];\n\n        (Array.isArray(stores) ? stores : [stores]).map(store => {\n            if(store.isDispatching()) {\n                promises.push(new Promise(resolve => store.once('dispatching:end', resolve)));\n            } else { promises.push(true); }\n        });\n\n        return Promise.all(promises).then(() => this.waiting.pop());\n    }\n}\n\nexport const ContextFactory = (propTypes) => {\n\n    return class FactoriedContext {\n\n        static childContextTypes = propTypes;\n        static propTypes = propTypes;\n\n        getChildContext() {\n            const res = {};\n            for(let propname in propTypes) { res[propname] = this.props[propname]; }\n            return res;\n        }\n\n        render() { return this.props.render(); }\n    };\n\n};\n"],"sourceRoot":"/source/"}